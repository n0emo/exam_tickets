# 18. Источники и типы записей в таблице маршрутизации: ПО, администратор, протоколы маршрутизации. Примеры таблиц маршрутизации: идеализированная таблица и реалистичные таблицы.

## Структура таблицы маршрутизации

Таблица маршрутизации — это база данных или электронная таблица, хранящаяся в памяти маршрутизатора или сетевого компьютера. Она описывает соответствие между адресами назначения и интерфейсами или шлюзами, через которые следует отправить пакет данных для достижения этого адреса. Таблица маршрутизации является основным инструментом принятия решений о продвижении пакетов в сети.

Типичная таблица маршрутизации содержит следующие поля: адрес сети назначения (или адрес конкретного узла), маску сети (определяющую границу между номером сети и номером узла), адрес шлюза (следующего маршрутизатора, которому нужно передать пакет), интерфейс (через который следует отправить пакет), метрику (числовое значение стоимости маршрута), и дополнительные служебные поля.

При поступлении пакета маршрутизатор анализирует адрес назначения и сравнивает его с записями в таблице. Выбирается наиболее конкретный маршрут - тот, у которого наибольшее совпадение с адресом назначения по маске. Если ни один маршрут не подходит, используется маршрут по умолчанию (default route), либо пакет отбрасывается с отправкой ICMP-сообщения об ошибке.

## Источники записей в таблице маршрутизации

Существуют три основных источника появления записей в таблице маршрутизации: программное обеспечение стека TCP/IP, администратор сети и протоколы динамической маршрутизации. Каждый источник создает записи определенного типа с различными свойствами и сроками жизни.

### Программное обеспечение стека TCP/IP

Первым источником записей является программное обеспечение сетевого стека, которое при инициализации маршрутизатора автоматически заносит в таблицу несколько записей, формируя так называемую минимальную таблицу маршрутизации. Это происходит на основе данных о конфигурации сетевых интерфейсов.

Программное обеспечение автоматически создает записи о непосредственно подключенных сетях (connected networks). Когда на интерфейсе маршрутизатора настраивается IP-адрес и маска подсети, стек TCP/IP автоматически добавляет в таблицу маршрут к этой сети. Например, если интерфейсу назначен адрес 192.168.1.1/24, автоматически появляется запись о сети 192.168.1.0/24, доступной через этот интерфейс без промежуточных шлюзов.

Кроме того, программное обеспечение заносит записи об адресах особого назначения. К ним относятся адрес loopback (127.0.0.0/8), используемый для локального тестирования стека TCP/IP - пакеты, направленные в эту сеть, не передаются на канальный уровень, а возвращаются локальному модулю IP. Также могут добавляться записи для групповых адресов (multicast, 224.0.0.0/4) и широковещательных адресов.

Записи, созданные программным обеспечением, обычно обозначаются в таблице специальными метками, такими как "Connected", "C" или "Direct", указывающими на то, что сеть доступна непосредственно через локальный интерфейс.

### Администратор сети

Вторым источником записей является администратор, который вручную формирует записи в таблице маршрутизации с помощью системных утилит. В операционных системах Unix и Windows для этого используется команда route, в Linux также доступна команда ip. В аппаратных маршрутизаторах (Cisco, Juniper) существуют специальные команды конфигурации для ручного задания маршрутов.

Записи, заданные вручную, всегда являются статическими - они не имеют срока истечения жизни и остаются в таблице до явного удаления. Эти записи могут быть постоянными (сохраняющимися после перезагрузки маршрутизатора) или временными (хранящимися только до выключения устройства).

Администратор часто вручную задает маршрут по умолчанию (default route) - специальную запись с адресом назначения 0.0.0.0 и маской 0.0.0.0, которая используется для пакетов, не подходящих ни под один другой маршрут. Такой маршрут обычно указывает на шлюз провайдера или главный маршрутизатор сети.

Также администратор может создавать специфичные для узла маршруты (host-specific routes), которые содержат полный IP-адрес конкретного узла вместо номера сети. Такие маршруты имеют маску 255.255.255.255 (/32) и используются, когда для определенного узла требуется особый путь, отличный от пути ко всей сети.

Статические маршруты обозначаются в таблице метками "Static", "S" или аналогичными, указывающими на ручное создание записи.

### Протоколы динамической маршрутизации

Третьим источником записей являются протоколы маршрутизации, такие как RIP (Routing Information Protocol), OSPF (Open Shortest Path First), EIGRP (Enhanced Interior Gateway Routing Protocol) и BGP (Border Gateway Protocol). Эти протоколы автоматически обмениваются информацией о топологии сети между маршрутизаторами и обновляют таблицы маршрутизации.

Записи, созданные протоколами маршрутизации, всегда являются динамическими - они имеют ограниченный срок жизни (TTL - Time To Live). Если маршрутизатор перестает получать обновления о маршруте, запись автоматически удаляется из таблицы после истечения таймера. Это позволяет сети адаптироваться к изменениям топологии, таким как отказы линий связи или маршрутизаторов.

В таблице маршрутизации записи от протоколов обозначаются специальными кодами: "R" для RIP, "O" для OSPF, "D" для EIGRP, "B" для BGP. Для динамических записей обычно указывается значение TTL, показывающее оставшееся время жизни записи.

Протоколы маршрутизации также используют метрики для сравнения маршрутов к одной и той же сети. Разные протоколы используют разные метрики: RIP считает количество переходов (hop count), OSPF использует стоимость на основе пропускной способности каналов, EIGRP применяет комбинированную метрику из пропускной способности, задержки и других параметров.

## Типы записей в таблице маршрутизации

Записи в таблице можно классифицировать по нескольким признакам. По источнику создания они делятся на автоматические (от программного обеспечения), статические (ручные) и динамические (от протоколов). По времени жизни - на постоянные (без срока истечения) и временные (с ограниченным TTL).

По типу адреса назначения записи бывают: сетевые (указывают путь ко всей сети), узловые (указывают путь к конкретному узлу с маской /32), маршрут по умолчанию (0.0.0.0/0), и специальные маршруты (loopback, multicast).

Аппаратные маршрутизаторы обычно показывают источник записи в отдельном поле (Source), что помогает администратору понять происхождение каждого маршрута. Программные маршрутизаторы в Windows и Linux часто не показывают эту информацию явно в основных командах просмотра.

## Примеры таблиц маршрутизации

### Идеализированная таблица маршрутизации

Идеализированная таблица маршрутизации содержит минимальный набор записей, необходимый для работы небольшой сети:

| Сеть назначения | Маска           | Шлюз        | Интерфейс |
|-----------------|-----------------|-------------|-----------|
| 192.168.1.0     | 255.255.255.0   | 0.0.0.0     | eth0      |
| 10.0.0.0        | 255.0.0.0       | 0.0.0.0     | eth1      |
| 0.0.0.0         | 0.0.0.0         | 192.168.1.1 | eth0      |

Эта простая таблица показывает три основные записи: локальная сеть 192.168.1.0/24 доступна напрямую через интерфейс eth0, локальная сеть 10.0.0.0/8 доступна напрямую через интерфейс eth1, и маршрут по умолчанию через шлюз 192.168.1.1 для всех остальных адресов.

### Реалистичная таблица Windows

Вывод команды `route print` в Windows показывает более подробную информацию:

| Сетевой адрес   | Маска сети      | Адрес шлюза   | Интерфейс     | Метрика |
|-----------------|-----------------|---------------|---------------|---------|
| 0.0.0.0         | 0.0.0.0         | 192.168.1.1   | 192.168.1.10  | 25      |
| 127.0.0.0       | 255.0.0.0       | On-link       | 127.0.0.1     | 331     |
| 127.0.0.1       | 255.255.255.255 | On-link       | 127.0.0.1     | 331     |
| 127.255.255.255 | 255.255.255.255 | On-link       | 127.0.0.1     | 331     |
| 192.168.1.0     | 255.255.255.0   | On-link       | 192.168.1.10  | 281     |
| 192.168.1.10    | 255.255.255.255 | On-link       | 192.168.1.10  | 281     |
| 192.168.1.255   | 255.255.255.255 | On-link       | 192.168.1.10  | 281     |
| 224.0.0.0       | 240.0.0.0       | On-link       | 127.0.0.1     | 331     |
| 224.0.0.0       | 240.0.0.0       | On-link       | 192.168.1.10  | 281     |
| 255.255.255.255 | 255.255.255.255 | On-link       | 127.0.0.1     | 331     |
| 255.255.255.255 | 255.255.255.255 | On-link       | 192.168.1.10  | 281     |

Эта таблица содержит маршрут по умолчанию, записи о локальной сети, специальные адреса loopback (127.0.0.0/8), multicast (224.0.0.0/4), широковещательные адреса и адрес самого интерфейса. Метка "On-link" указывает на непосредственно подключенные сети.

### Реалистичная таблица Linux

Вывод команды `route -n` или `ip route show` в Linux:

| Destination  | Gateway      | Genmask         | Flags | Metric | Ref | Use | Iface |
|--------------|--------------|-----------------|-------|--------|-----|-----|-------|
| 0.0.0.0      | 192.168.1.1  | 0.0.0.0         | UG    | 100    | 0   | 0   | eth0  |
| 10.0.0.0     | 0.0.0.0      | 255.0.0.0       | U     | 0      | 0   | 0   | eth1  |
| 169.254.0.0  | 0.0.0.0      | 255.255.0.0     | U     | 1000   | 0   | 0   | eth0  |
| 192.168.1.0  | 0.0.0.0      | 255.255.255.0   | U     | 100    | 0   | 0   | eth0  |

Флаги означают: U (Up - маршрут активен), G (Gateway - используется шлюз), H (Host - маршрут к конкретному узлу). Поле Metric показывает предпочтительность маршрута, Use отражает количество использований. Адрес 169.254.0.0 - это link-local адрес, используемый при отсутствии DHCP.

### Таблица аппаратного маршрутизатора

Пример таблицы маршрутизатора Cisco или аналогичного оборудования с указанием источников:

| Network      | Mask          | Gateway       | Source    | TTL | Interface |
|--------------|---------------|---------------|-----------|-----|-----------|
| 192.168.1.0  | 255.255.255.0 | 0.0.0.0       | Connected | -   | Port 1    |
| 10.0.0.0     | 255.0.0.0     | 0.0.0.0       | Connected | -   | Port 2    |
| 172.16.0.0   | 255.255.0.0   | 192.168.1.254 | Static    | -   | Port 1    |
| 192.168.5.0  | 255.255.255.0 | 10.0.0.1      | RIP       | 160 | Port 2    |
| 0.0.0.0      | 0.0.0.0       | 192.168.1.1   | Static    | -   | Port 1    |

В этой таблице четко видны источники записей. Первые две созданы автоматически при конфигурации портов (Connected) - это непосредственно подключенные сети. Следующие две добавлены администратором вручную (Static) - маршрут к сети 172.16.0.0 и маршрут по умолчанию. Одна запись получена от протокола RIP с TTL 160 секунд, что означает, что она будет удалена через 160 секунд, если не придет обновление.

Такая детализация помогает администратору понимать происхождение каждого маршрута и принимать решения об изменении конфигурации. Наличие поля TTL для динамических записей позволяет отслеживать актуальность информации от протоколов маршрутизации.

**Источники:**
- https://ru.wikipedia.org/wiki/Таблица_маршрутизации
- https://studopedia.ru/15_90521_istochniki-i-tipi-zapisey-v-tablitse-marshrutizatsii.html
- http://xgu.ru/wiki/Таблица_маршрутизации
- https://www.osp.ru/lan/2001/06/134894
